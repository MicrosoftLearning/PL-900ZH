---
lab:
    title: '实验室 1： 数据建模'
    module: '模块 2： Common Data Service 简介'
---

# 模块 2： Common Data Service 简介
## 实验室：数据建模


# 应用场景

贝洛斯学院 (Bellows College) 是一所教育机构，校园内有多座建筑。目前，校园访问记录在纸质日报上。无法始终如一地捕获信息，也无法收集和分析有关整个校园的访问数据。 

校园管理部门希望对其访客登记系统进行现代化改造。在该系统中，由安全人员控制对建筑物的访问，所有访问都必须由主办人预先登记和记录。

在整个课程中，你将生成应用程序并执行自动化，以使 Bellows College 的管理和安全人员可以管理和控制校园建筑的出入情况。 

在本实验室中，你将访问环境、创建 Common Data Service (CDS) 数据库并创建解决方案以跟踪你的更改。你还将创建一个数据模型来满足以下要求：

-   R1 – 跟踪校园访问的位置（建筑物）
-   R2 - 记录基本信息以识别和跟踪访问者 
-   R3 - 安排、记录和管理访问 

最后，你会将示例数据导入 Common Data Service。

# 概要实验室步骤

为了准备学习环境，你将：

* 创建解决方案和发布者
* 添加满足应用程序要求所需的新组件和现有组件。请参阅[数据模型文档](../../Allfiles/Campus%20Management.png)以获取有关元数据的描述（实体和关系）。你可以按住 Ctrl 键单击或右键单击链接以在新窗口中打开数据模型文档。

完成所有定制后，你的解决方案将包含多个实体：

-   联系人
-   生成
-   访问

## 先决条件：

* 完成 **模块 0 实验 0 - 验证实验室环境**

## 开始前要考虑的事项：

* 命名约定

* 数据类型、限制（例如，名称的最大长度）

* 日期/时间格式支持轻松本地化

# 练习 \#1：创建解决方案

## 任务 \#1：创建解决方案和发布者

1.  创建解决方案

    -   导航至 <https://make.powerapps.com>。你可能需要重新进行验证身份 - 单击 **“登录”** 并根据需要按照说明进行操作。

    -   通过单击屏幕右上角的 **“环境”**，然后从下拉菜单中选择你的环境来选择环境。

    -   从左侧菜单中选择 **“解决方案”**，然后单击 **“新解决方案”**。

    -   在 **“显示名称”** 中输入 **“[你的姓氏] 校园管理”**。

2.  创建发布者

    -   单击 **“发布者”** 下拉菜单并选择 **“发布者”**。

    -   在弹出的窗口中，在 **“显示名称”** 部分输入 **“Bellows College”** 
    
    -   在 **“前缀”** 中输入 **“bc”**

    -   单击 **“保存并关闭”**
    
    -   在弹出窗口中单击 **“完成”**。

3.  完成解决方案的创建。

    -   现在，单击 **“发布者”** 下拉菜单，然后选择 **“贝洛斯学院”**，
        你刚刚创建的发布者。

    -   验证 **“版本”** 是否设置为 **“1.0.0.0”**。 
    
    -   单击 **“创建”**。

## 任务 \#2：添加现有实体

1.  单击打开你刚刚创建的 **“校园管理”** 解决方案。

2.  单击 **“添加现有”** 然后选择 **“实体”**。

3.  找到 **“联系人”** 并选择它。

4.  单击 **“下一步”**。

5.  单击“联系人”下的 **“选择组件”**。

6.  选择 **“视图”** 标签，然后选择 **“可用联系人”** 视图。单击
    **“添加”**。
    
7.  请再次点击 **“选择组件”**。

8.  选择 **“Forms”** 标签，然后选择 **“联系人”** form。
    
9.  单击 **“添加”**。

    > **“1 视图”** 和 **“1 窗体”** 应属于选中状态。 
    
10.  再次单击 **“添加”**。这会将具有选定视图和表单的“联系人”实体添加到新创建的解决方案中。 
    
11.  你的解决方案现在应具有一个实体：联系人。

# 练习 \#2：创建实体和关系

**目标：** 在本练习中，你将在实体之间创建实体并添加关系
。

## 任务 #1：创建“建筑物”实体和字段

1.  你仍应打开浏览器以访问“校园管理”解决方案。如果不这样做，请按照以下步骤打开“校园管理”解决方案：

    * 登录到 <https://make.powerapps.com>（若尚未登录）
    
    * 选择 **“解决方案”** 并单击，以打开你刚刚创建的 **“[Your Last Name] Campus Management”**
          解决方案。
          
2.  创建“建筑物”实体

    -   单击 **“新建”**，然后选择 **“实体”**。
    
    -   在 **“显示名称”** 部分输入 **“Building”**。 
    
    -   单击 **“完成”**。这将开始在后台预配实体，同时你可以开始添加其他实体和字段。

## 任务 #2：创建访问实体和字段

**“访问”** 实体将包含有关校园访问的信息，包括建筑物、访问者、每次访问的计划时间和实际时间。 

我们希望为每次访问分配一个唯一的号码，当访客在访问签到过程中被询问时，他可以很容易地输入并解释该号码。

> 我们用 **“时区无关”** 行为记录日期和时间信息，因为访问时间始终与建筑物所在位置的本地时间一致，因此当从不同时区查看时，不应更改此信息。 

1.  选择 **“校园管理”** 解决方案

2. 创建“访问”实体

   * 单击 **“新建”**，然后选择 **“实体”**。
   
   * 为 **“显示名称”** 输入 **“访问”** 
   
   * 单击 **“完成”**。这将开始在后台预配实体，同时可以开始添加其他字段。

3. 创建“计划开始时间”字段

   * 请确保 **“字段”** 选项卡已选中并单击 **“添加字段”**。
   
   * 为 **“显示名称”** 输入 **“计划开始时间”**。
   
   * 为 **“数据类型”** 选择 **“数据和时间”**。
   
   * 在 **“必需”** 字段中，选择 **“必需”**。
   
   * 展开 **“高级选项”** 部分。
   
   * 在 **“行为”** 字段中，选择 **“与时区无关”**。
   
   * 单击 **“完成”**。

4.  创建“计划结束”字段

    * 单击 **“添加字段”**。
    
    * 为 **“显示名称”** 输入 **“计划结束”**。
    
    * 为 **“数据类型”** 选择 **“数据和时间”**。
    
    * 在 **“必需”** 字段中，选择 **“必需”**。
    
    * 展开 **“高级选项”** 部分。
    
    * 在 **“行为”** 字段中，选择 **“与时区无关”**。
    
    * 单击 **“完成”**。
    
5.  创建“实际开始时间”字段

    * 单击 **“添加字段”**。
    
    * 为 **“显示名称”** 输入 **“实际开始时间”**。
    
    * 为 **“数据类型”** 选择 **“数据和时间”**。
    
    * 在 **“必需”** 字段中，将其保留为 **“可选”**。
    
    * 展开 **“高级选项”** 部分。
    
    * 在 **“行为”** 字段中，选择 **“与时区无关”**。
    
    * 单击 **“完成”**。
    
6.  创建“实际结束时间”字段

    * 单击 **“添加字段”**。
    
    * 为 **“显示名称”** 输入 **“实际结束时间”**。
    
    * 为 **“数据类型”** 选择 **“数据和时间”**。
    
    * 在 **“必需”** 字段中，将其保留为 **“可选”**。
    
    * 展开 **“高级选项”** 部分。
    
    * 在 **“行为”** 字段中，选择 **“与时区无关”**。
    
    * 单击 **“完成”**。
    
7.  创建“代码”字段

    * 单击 **“添加字段”**。
    
    * 为 **“显示名称”** 输入 **“代码”**。
    
    * 为 **“数据类型”** 选择 **“自动编号”**。
    
    * 为 **“自动编号类型”** 选择 **“带日期前缀的数字”**。
    
    * 单击 **“完成”**。
    
8.  单击 **“保存实体”**

## 任务 #3：创建关系

1.  确保你仍在查看**校园管理**解决方案的 **“访问”** 实体。如果没有，请导航到那里。

2.  创建访问到联系人的关系

    * 选择 **“关系”** 选项卡。
    
    * 单击 **“添加关系”**，然后选择 **“多对一”**
    
    * 为 **“相关(一个)”** 选择“联系人” 
    
    * 为 **“查找字段显示名称”** 输入 **“访客”** 
    
    * 单击 **“完成”**。
    
3.  创建访问到建筑物的关系

    * 单击 **“添加关系”**，然后选择 **“多对一”**
    
    * 为 **“相关（一个）”** 选择 **“选择建筑物”**
    
    * 单击 **“完成”**。
    
4.  单击 **“保存实体”**。

5.  在顶部菜单中选择 **“解决方案”**，然后单击 **“发布所有自定义项”。**

# 练习 \#3：导入数据

**目标：** 在本练习中，你要将示例数据导入 Common Data Service 数据库。

## 任务 #1：导入解决方案

在此任务中，你将导入一个包含完成数据导入所需的 Power Automate 流的解决方案。

1. 你的桌面上应该有 **DataImport_managed.zip** 文件存储。下载[“数据导入解决方案”](../../Allfiles/DataImport_managed.zip)（如果你尚未下载）。

2. 登录至 <https://make.powerapps.com>。

3. 如果尚未选择你的 **“姓名首字母练习”** 环境，请在右上角选择它。

4. 在左侧导航面板中选择 **“解决方案”**。

5. 单击 **“导入”**，然后单击 **“浏览”**。从你的桌面浏览并选择 **DataImport_managed.zip**，然后按 **“下一步”**。

>   你可能会收到以下消息：
>
>   缺少依赖项。在安装此解决方案之前，请先安装以下解决方案...
>
>   该消息表明要么数据模型不完整，要么
>   发布者前缀不是 **bc**， 或者**建筑物**和**访问**实体
>   名称与上述步骤中列出的名称不同。

6. 按 **“下一步”**。系统应该会提示你重新建立连接。 

7. 展开 **“选择连接”** 下拉菜单并选择 **“新建连接”**。

8. 新的浏览器窗口或选项卡将打开。当提示你创建 Common Data Service 连接时，请选择 **“创建”**。如果需要完成创建连接，请登录。

9. 切换回要导入解决方案的上一个选项卡。

10. 单击 **“刷新”** 以刷新连接列表。 

11. 确保已选择刚刚创建的连接。

12. 按 **“导入”**

13. 等待导入完成。

## 任务 #2：导入数据  

1. 打开 **“数据导入”** 解决方案。

2. 检查 **“导入数据”** 流的 **“状态”**。

3. 如果 **“状态”** 为 **“关闭”**，请选择 **“导入数据”** 旁边的 **“...”**，然后选择 **“打开”**。

   > **重要事项：** 如果你收到错误消息，请验证你创建的实体和字段与上面的说明一致。

4. 打开 **“导入数据”** 组件。一个新的选项卡将打开 Power Automate。 

5. 如果出现弹出窗口，请单击 **“开始”**。 

6. 单击 **“运行”**，然后在提示时单击 **“运行流”**。

7. 单击 **“完成”**。

8. 等待流实例完成运行。你可以刷新 **28 天运行历史记录**表，以查看流何时运行过。 

    > 该流的目的是为即将进行的实验室生成示例数据。在下一个任务中，你将验证数据导入是否成功。 

## 任务 #3：验证数据导入

1. 导航回到上一个 Power Apps 选项卡。在弹出窗口中单击 **“完成”**。在左侧导航栏上选择 **“解决方案”**，然后打开你的 **“校园管理”** 解决方案。

2. 单击打开 **“访问”** 实体，然后选择 **“数据”** 选项卡。

3. 单击右上角的 **“活动访问”** 以显示视图选择器，然后选择 **“所有字段”**。这将更改用于显示访问数据的视图。 

    > 如果由于分辨率较低而看不到 **“活动访问”**，你应该会在同一位置看到一个眼睛图标。

    > 如果导入成功，应该会显示访问条目列表。

4. 单击 **“建筑”** 列中的任意值，请确认该“建筑”窗体在单独的窗口中打开。 

5. 关闭最近启动的窗口。

6. 单击 **“游客”** 列中的任意值（你可能需要向右滚动视图），请确认联系人窗体在单独的窗口中打开。

7. 关闭最近启动的窗口。

# 挑战

* 你会考虑使用 *“约定”* 作为解决方案的一部分吗？它会改变什么？
* 如何将计划的结束时间强行安排在计划的开始时间之后？ 
* 你如何在一次访问中添加对多个会议的支持？
* 如何为外部联系人和内部工作人员取得建筑的访问权限？
* 如何使特定建筑物的访问需要管理层批准？数据模型中的审批流程会发生什么变化？

