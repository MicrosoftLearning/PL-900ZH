---
lab:
    title: “实验室 02：画布应用，第 1 部分”
    module: “模块 XX：Power Apps 生成”
---

# PL-900：Microsoft Power Platform 基础知识
## 模块 X，实验室 2 – 画布应用 - 第 1 部分

应用场景
========

贝洛斯学院 (Bellows College) 是一所教育机构，校园内有多座建筑。目前，校园访问记录在纸质日报上。无法始终如一地捕获信息，也无法收集和分析有关整个校园的访问数据。 

校园管理部门希望对其访问者登记系统进行现代化改造，在该系统中，由安全人员控制对建筑物的访问，并且所有访问都必须由其主持人预先登记和记录。

在本课程中，你将生成应用程序并执行自动化，以使贝洛斯学院 (Bellows College) 的管理和安全人员可以管理和控制对校园建筑物的访问。  

在本实验室的第 1 部分，你将设计一个 PowerApps 画布应用，学院工作人员可以使用该应用管理其来宾的访问。

概要实验室步骤
======================

我们将按照以下概要设计画布应用：

-   使用手机外形规格模板根据数据创建应用
-   包含访问信息的“详细信息”页面
-   用于创建访问的“编辑”页面
-   显示访问量的库控件
-   在库数据源中添加筛选以仅显示将来的访问

## 先决条件

* 完成实验室 1 - 数据建模

开始前要考虑的事项
-----------------------------------

-   目标受众最普遍的外形规格是什么
-   估计系统中的记录数 
-   如何缩小所选记录的范围以提高应用的性能和用户采用率


练习 1：创建员工画布应用
===============================

**目标：**在本练习中，要根据模板生成画布应用，然后对其进行修改以包括所需的数据

任务 \#1：创建画布应用
---------------------------

在本任务中，你将使用基于 Common Data Service 的电话布局模板创建画布应用。若使用“访问”作为 CDS 中的选定实体，模板将生成“库 - 视图 - 编辑”应用以管理校园访问。

1.  打开校园管理解决方案。

    -   登录至 <https://make.powerapps.com>

    -   选择你的 **“环境”。**

    -   选择 **“应用”**。

2.  新建画布应用程序

    -   请单击 **“新建应用 | 画布应用”**。
    -   在 **“Common Data Service”** 下选择 **“手机布局”**  
-   选择 **“Common Data Service”** 连接，然后单击 **“创建”** 
    -   选择 **“访问”** 表
    -   单击 **“连接”** 
3.  保存应用程序
    1.  单击 **“文件”>“保存”** 
    2.  键入应用名称为**校园职员**
    3.  按下 **“保存”** 

任务 \#2：配置访问量明细表
--------------------------------

在本任务中，你将配置明细表以查看有关个人访问记录的信息

1.  在 **“树视图”** 下展开 **“DetailScreen1”** 
2.  选择 **“DetailForm1”** 
3.  在“属性”面板中，在**字段**旁边选择 **“编辑”** 
4.  单击 **“添加字段”** 
5.  选择以下字段
    * 实际结束
    * 实际开始
    * 生成 
    * 代码
    * 计划结束
    * 计划开始
    * 访问者
6.  单击 **“添加”** 
7.  通过上下拖动字段名称来重新排列字段。推荐的顺序是：
    * 代码、名称、建筑物、访问者、计划开始时间、计划结束时间、实际开始时间、实际结束时间
8.  要保留进行中的工作，请单击 **“文件 | 保存”**，然后按 **“保存”**  

## 任务 3：配置访问编辑窗体 

在本任务中，你将配置一个窗体来编辑个人访问记录相关信息

1.  在 **“树视图”** 下展开 **“EditScreen1”** 
2.  选择 **“EditForm1”** 
3.  选择 **“创建时间”** 字段，然后按下 **“Delete”** 键删除字段
4.  在“属性”面板中选择 **“编辑字段”** 
5.  单击 **“添加字段”** 
6.  选择以下字段
    * 生成 
    * 计划结束
    * 计划开始
    * 访问者
7.  单击 **“添加”** 
8.  通过上下拖动字段名称来重新排列字段。推荐的顺序是：
    * 名称、建筑物、访问者、计划开始时间、计划结束时间
9.  要保留进行中的工作，请单击 **“文件 | 保存”**，然后按 **“保存”**  

任务 \#4：配置访问库
---------------------------------------

在本任务中，你将配置预生成的库以显示访问的标题、开始和结束日期。 

1.  在 **“树视图”** 下展开 **“BrowseScreen1”** 
2.  选择 **“BrowseGallery1”** 
3.  从“属性”下拉列表中选择 **“TemplateSize”** 属性
4.  用以下  `Min(150, BrowseGallery1.Height - 60)` 替换表达式。这样可以确保有足够的空间来容纳其他信息。
5.  通过按下库左上角的“铅笔图标”来编辑库
6.  选择带有日期时间的字段 
7.  将**文本**属性由 `ThisItem.'Created On'` 更改为 `ThisItem.'Scheduled Start'`
8.  再次选择字段
9.  按下`CTRL-C`，然后按下`CTRL-V`，以创建该字段的副本。
10.  使用鼠标或键盘，向下移动复制的控件，并将其与库中的其他控件对齐
11.  将**文本**属性更改为 `ThisItem.'Scheduled End'`
12.  要保留进行中的工作，请单击 **“文件 | 保存”**，然后按 **“保存”**  

## 任务 6：添加日期筛选器

由于访问量持续增长，因此用户需要一种可筛选访问库的功能。例如，用户可能只想查看将来的访问。在本任务中要添加一项功能，以便仅显示用户选择日期之后的访问。

1. 选择 **“插入”** 菜单

2. 请单击 **输入 | 日期选择器** 

3. 使用键盘或鼠标，在搜索框下方定位控件。

4. 选择 **“BrowseGallery1”**  

5. 调整库控件的大小并移动它，使其位于日期选取器下方并覆盖屏幕。

6. 选择 **“项”** 属性

7. 在表达式中，找到 `[@Visits]`，然后将其替换为 `Filter(Visits,'Scheduled End' >= DatePicker1.SelectedDate)`。整个表达式应该如下所示：

   ```
   SortByColumns(
   	Search(
        Filter(
        	Visits,
            'Scheduled End' >= DatePicker1.SelectedDate
           ),
           TextSearchBox1.Text,
       	"bc_code","bc_name"
       ),
     "bc_code",
     If(SortDescending1, Descending, Ascending)
   )
   ```
   
8. 要保留进行中的工作，请单击 **“文件 | 保存”**，然后按 **“保存”** 

# 练习 2：完成应用

在本练习中，你将测试该应用程序，一旦成功，就将其添加到解决方案中。

任务 \#1：测试应用
--------------------------

1.  启动应用程序

    -   选择 **“BrowseScreen1”**，然后按 **F5** 或单击 **“预览应用”**。
    -   该应用程序应加载并显示访问列表。 
    -   通过在日期选取器控件中选择不同的日期来测试筛选器
    -   选择一个访问并验证显示表单是否正常工作
    -   返回库，然后按 + 以新建一个访问。验证编辑表单是否包含必填字段，包括访客、建筑物以及计划的开始和结束日期。
    -   填写信息并提交。验证新记录是否出现在库中。
    -   按下 **ESC** 键关闭应用

2.  保存并发布应用程序

    -   单击 **“文件”**，然后单击 **“保存”**。

    -   单击“发布”。

    -   请点击 **“发布此版本”**。

    -   单击 **“关闭”**。

    -   关闭 **“设计器”** 浏览器窗口或选项卡。

    -   如果在尝试关闭浏览器窗口时出现提示，请单击 **“离开”**。

    -   导航回到上一个窗口，然后单击 **“完成”**。

## 任务 2：将应用添加到解决方案并发布 

1. 打开校园管理解决方案。
   * 登录至 <https://make.powerapps.com>
   * 选择你的 **“环境”。**
   * 选择 **“解决方案”**。
   * 单击打开 **“校园管理”** 解决方案。
2. 选择 **“添加现有”>“应用”>“画布应用”** 
3. 选择 **“外部解决方案”** 选项卡
4. 选择 **“校园职员”** 应用，单击 **“添加”** 
5. 选择 **“校园职员”** 应用，单击 **“编辑”** 
6. 选择 **“文件”>“发布”**  

# 挑战

* 所有访问的日历视图，并按日期范围筛选
* 能够创建和管理应用中的联系人
* 如何在一次访问中显示多个会议

